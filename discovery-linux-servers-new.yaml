---
    - hosts: all
      become: yes
      tasks:
      # - name: Create discovery directory
      #   file:
      #     path: /tmp/discovery
      #     state: directory
      - name: Create local directory on jumpserver
        file:
          path: "/oxxo/{{ inventory_hostname }}"
          state: directory
        delegate_to: localhost
        become: false
      - name: Check Multi-Path Storage Configuration Linux 5 / 6 series
        command: /etc/init.d/multipathd status
        when: ansible_facts['distribution_major_version'] == "5" or ansible_facts['distribution_major_version'] == "6"
        ignore_errors: true
        register: mpio_ver_el_5_6
      - debug:
          var: mpio_ver_el_5_6
      - name: MPIO Red Hat Enterprise Linux 7 series
        command: systemctl status multipathd
        when: ansible_facts['distribution_major_version'] == "7" or ansible_facts['distribution_major_version'] == "9"
        ignore_errors: true
        register: mpio_ver_el_7
      - debug:
          var: mpio_ver_el_7
      - name: View network configuration (IP address, subnet mask, gateway)
        shell: |
          echo "============================="
          echo "===Interface configuration==="
          ifconfig
          echo "============================="
          echo "===Netstat ports==="
          netstat -tuln
          echo "============================="
          echo "===IP direction and Routes==="
          ip route 
          echo "============================="
          echo "===Network interfaces and their configurations==="
          ip a
          echo "============================="
        register: networking_info
      - debug:
          var: networking_info
      - name: Running Processes
        command: ps aux
        register: proc_info
      - debug:
          var: proc_info
      - name: Disk Info
        shell: |
          echo "===================="
          echo "# Disk partitions  #"
          df -h
          echo "=======================================
          echo "# View disk and partition information #"
          lsblk
          echo "======================================="
          echo "# View RAID information #"
          cat /proc/mdstat
          echo "========================="
          echo "# View SCSI/SAS controller information #"
          lsscsi
          echo "========================================"
        register: diskinfo
      - debug:
          var: diskinfo
      - name: Collect system information
        shell: |
          echo "=========="
          echo "# uname #"
          uname -a
          echo "=========="
          echo "# Detailed system information #"
          cat /etc/os-release
          echo "==============================="
          echo "# View information about PCIe cards #"
          lspci
          echo "====================================="
        register: sysinfo
      - debug:
          var: sysinfo
      - name: CPU / MEM Info
        shell: |
          echo "========================"
          echo "# View CPU information #"
          lscpu
          echo "========================"
          echo "# View current memory usage #"
          free -h
          echo "============================="
        register: cpu_mem_info
      - debug:
          var: cpu_mem_info
      - name: Services status
        shell: |
          echo "============================================="
          echo "# Show all apps/services running (RHEL 5/6) #"
          service --status-all
          echo "============================================="
          echo "# Show all apps/services running (RHEL 7/8) #"
          systemctl list-unit-files
          echo "============================================="
          echo "# Show all apps/services running (RHEL 8) #"
          sudo systemctl list-units --type=service
          echo "============================================="
        register: svcs
      - debug:
          var: svcs
      - name: "Show installed applications/packages"
        shell: |
          echo "=========================================="
          echo "# Show installed applications/packages #"
          rpm -qa
          echo "============================="
        register: pkgs_info
      - debug:
          var: pkgs_info
      - name: Save outputs to local directory
        copy:
          content: "{{ item.output.stdout }}"
          dest: "/oxxo/{{inventory_hostname}}/{{ item.name }}.txt"
        when: item.output.stdout is defined
        with_items:
          - { name: mpio_ver_el_5_6 , output: "{{mpio_ver_el_5_6}}" }
          - { name: mpio_ver_el_7 , output: "{{mpio_ver_el_7}}" }
          - { name: networking_info , output: "{{networking_info}}" }
          - { name: proc_info , output: "{{proc_info}}" }
          - { name: disk_info , output: "{{diskinfo}}" }
          - { name: system_info , output: "{{sysinfo}}" }
          - { name: cpu_mem_info , output: "{{cpu_mem_info}}" }
          - { name: services_info , output: "{{svcs}}" } 
          - { name: packages_apps_info , output: "{{pkgs_info}}" }
        become: false
        delegate_to: localhost